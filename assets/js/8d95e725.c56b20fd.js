"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[622],{6058:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>t,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"ros2/lab-exercises/lab2","title":"Lab Exercise 2 - Services and Actions in ROS 2","description":"Objective","source":"@site/docs/ros2/lab-exercises/lab2.md","sourceDirName":"ros2/lab-exercises","slug":"/ros2/lab-exercises/lab2","permalink":"/my-website/ros2/lab-exercises/lab2","draft":false,"unlisted":false,"editUrl":"https://github.com/Bushraturk/my-website/edit/main/docs/docs/ros2/lab-exercises/lab2.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Lab Exercise 2 - Services and Actions in ROS 2","sidebar_position":2},"sidebar":"textbookSidebar","previous":{"title":"Lab Exercise 1 - Basic Node Communication","permalink":"/my-website/ros2/lab-exercises/lab1"},"next":{"title":"Quiz 1 - ROS 2 Architecture Fundamentals","permalink":"/my-website/ros2/assessments/quiz1"}}');var i=r(4848),a=r(8453);const t={title:"Lab Exercise 2 - Services and Actions in ROS 2",sidebar_position:2},c="Lab Exercise 2: Services and Actions in ROS 2",l={},o=[{value:"Objective",id:"objective",level:2},{value:"Learning Objectives",id:"learning-objectives",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Equipment Required",id:"equipment-required",level:2},{value:"Lab Steps",id:"lab-steps",level:2},{value:"Step 1: Create a ROS 2 Package",id:"step-1-create-a-ros-2-package",level:3},{value:"Step 2: Create the Service Files",id:"step-2-create-the-service-files",level:3},{value:"Step 3: Create the Action Files",id:"step-3-create-the-action-files",level:3},{value:"Step 4: Make Scripts Executable and Configure Setup",id:"step-4-make-scripts-executable-and-configure-setup",level:3},{value:"Step 5: Build and Test Your Package",id:"step-5-build-and-test-your-package",level:3},{value:"Step 6: Test Your Service Implementation",id:"step-6-test-your-service-implementation",level:3},{value:"Step 7: Test Your Action Implementation",id:"step-7-test-your-action-implementation",level:3},{value:"Expected Results",id:"expected-results",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Extension Activities",id:"extension-activities",level:2},{value:"Assessment Questions",id:"assessment-questions",level:2},{value:"Summary",id:"summary",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"lab-exercise-2-services-and-actions-in-ros-2",children:"Lab Exercise 2: Services and Actions in ROS 2"})}),"\n",(0,i.jsx)(n.h2,{id:"objective",children:"Objective"}),"\n",(0,i.jsx)(n.p,{children:"In this lab exercise, you will implement service-server and action-based communication in ROS 2 to understand advanced communication patterns used in robotics applications."}),"\n",(0,i.jsx)(n.h2,{id:"learning-objectives",children:"Learning Objectives"}),"\n",(0,i.jsx)(n.p,{children:"After completing this lab, you will be able to:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Create and implement a ROS 2 service server and client"}),"\n",(0,i.jsx)(n.li,{children:"Implement a ROS 2 action server and client"}),"\n",(0,i.jsx)(n.li,{children:"Compare the use cases for services versus actions"}),"\n",(0,i.jsx)(n.li,{children:"Understand when to use each communication pattern"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"ROS 2 installation (Humble Hawksbills or later)"}),"\n",(0,i.jsx)(n.li,{children:"Basic Python programming knowledge"}),"\n",(0,i.jsx)(n.li,{children:"Understanding of ROS 2 advanced concepts (covered in Week 3 content)"}),"\n",(0,i.jsx)(n.li,{children:"Completion of Lab Exercise 1 (Basic Node Communication)"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"equipment-required",children:"Equipment Required"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Computer with ROS 2 installed"}),"\n",(0,i.jsx)(n.li,{children:"Terminal/shell access"}),"\n",(0,i.jsx)(n.li,{children:"Text editor or IDE"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"lab-steps",children:"Lab Steps"}),"\n",(0,i.jsx)(n.h3,{id:"step-1-create-a-ros-2-package",children:"Step 1: Create a ROS 2 Package"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Navigate to your workspace source directory:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd ~/ros2_ws/src\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Create a new ROS 2 package called ",(0,i.jsx)(n.code,{children:"robot_advanced_lab"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ros2 pkg create --build-type ament_python robot_advanced_lab\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Navigate to the package directory:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd robot_advanced_lab\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"step-2-create-the-service-files",children:"Step 2: Create the Service Files"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Create directories for your code:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"mkdir robot_advanced_lab\r\ncd robot_advanced_lab\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Create a service server called ",(0,i.jsx)(n.code,{children:"math_service.py"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.node import Node\r\nfrom example_interfaces.srv import AddTwoInts\r\n\r\n\r\nclass MathService(Node):\r\n\r\n    def __init__(self):\r\n        super().__init__('math_service')\r\n        self.srv = self.create_service(AddTwoInts, 'add_two_ints', self.add_callback)\r\n\r\n    def add_callback(self, request, response):\r\n        response.sum = request.a + request.b\r\n        self.get_logger().info(f'Incoming request: {request.a} + {request.b} = {response.sum}')\r\n        return response\r\n\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    math_service = MathService()\r\n    rclpy.spin(math_service)\r\n    math_service.destroy_node()\r\n    rclpy.shutdown()\r\n\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Create a service client called ",(0,i.jsx)(n.code,{children:"math_client.py"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import sys\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom example_interfaces.srv import AddTwoInts\r\n\r\n\r\nclass MathClient(Node):\r\n\r\n    def __init__(self):\r\n        super().__init__('math_client')\r\n        self.client = self.create_client(AddTwoInts, 'add_two_ints')\r\n        while not self.client.wait_for_service(timeout_sec=1.0):\r\n            self.get_logger().info('Service not available, waiting again...')\r\n        self.request = AddTwoInts.Request()\r\n\r\n    def send_request(self, a, b):\r\n        self.request.a = a\r\n        self.request.b = b\r\n        future = self.client.call_async(self.request)\r\n        return future\r\n\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    \r\n    if len(sys.argv) != 3:\r\n        print('Usage: ros2 run robot_advanced_lab math_client <int1> <int2>')\r\n        return\r\n    \r\n    math_client = MathClient()\r\n    future = math_client.send_request(int(sys.argv[1]), int(sys.argv[2]))\r\n    \r\n    while rclpy.ok():\r\n        rclpy.spin_once(math_client)\r\n        if future.done():\r\n            try:\r\n                response = future.result()\r\n                math_client.get_logger().info(f'Result: {response.sum}')\r\n            except Exception as e:\r\n                math_client.get_logger().info(f'Service call failed: {e}')\r\n            break\r\n\r\n    math_client.destroy_node()\r\n    rclpy.shutdown()\r\n\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"step-3-create-the-action-files",children:"Step 3: Create the Action Files"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Create an action server called ",(0,i.jsx)(n.code,{children:"fibonacci_action_server.py"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import time\r\nimport rclpy\r\nfrom rclpy.action import ActionServer, CancelResponse, GoalResponse\r\nfrom rclpy.node import Node\r\nfrom example_interfaces.action import Fibonacci\r\n\r\n\r\nclass FibonacciActionServer(Node):\r\n\r\n    def __init__(self):\r\n        super().__init__('fibonacci_action_server')\r\n        self._action_server = ActionServer(\r\n            self,\r\n            Fibonacci,\r\n            'fibonacci',\r\n            execute_callback=self.execute_callback,\r\n            goal_callback=self.goal_callback,\r\n            cancel_callback=self.cancel_callback)\r\n\r\n    def destroy(self):\r\n        self._action_server.destroy()\r\n        super().destroy_node()\r\n\r\n    def goal_callback(self, goal_request):\r\n        self.get_logger().info('Received goal request')\r\n        return GoalResponse.ACCEPT\r\n\r\n    def cancel_callback(self, goal_handle):\r\n        self.get_logger().info('Received cancel request')\r\n        return CancelResponse.ACCEPT\r\n\r\n    def execute_callback(self, goal_handle):\r\n        self.get_logger().info('Executing goal...')\r\n        \r\n        feedback_msg = Fibonacci.Feedback()\r\n        feedback_msg.sequence = [0, 1]\r\n        \r\n        for i in range(1, goal_handle.request.order):\r\n            if goal_handle.is_cancel_requested:\r\n                goal_handle.canceled()\r\n                self.get_logger().info('Goal canceled')\r\n                return Fibonacci.Result()\r\n\r\n            feedback_msg.sequence.append(\r\n                feedback_msg.sequence[i] + feedback_msg.sequence[i-1])\r\n            \r\n            self.get_logger().info(f'Feedback: {feedback_msg.sequence}')\r\n            goal_handle.publish_feedback(feedback_msg)\r\n            \r\n            time.sleep(1)\r\n\r\n        goal_handle.succeed()\r\n        result = Fibonacci.Result()\r\n        result.sequence = feedback_msg.sequence\r\n        return result\r\n\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    action_server = FibonacciActionServer()\r\n    rclpy.spin(action_server)\r\n    action_server.destroy()\r\n    rclpy.shutdown()\r\n\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Create an action client called ",(0,i.jsx)(n.code,{children:"fibonacci_action_client.py"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import time\r\nimport rclpy\r\nfrom rclpy.action import ActionClient\r\nfrom rclpy.node import Node\r\nfrom example_interfaces.action import Fibonacci\r\n\r\n\r\nclass FibonacciActionClient(Node):\r\n\r\n    def __init__(self):\r\n        super().__init__('fibonacci_action_client')\r\n        self._action_client = ActionClient(\r\n            self,\r\n            Fibonacci,\r\n            'fibonacci')\r\n\r\n    def send_goal(self, order):\r\n        goal_msg = Fibonacci.Goal()\r\n        goal_msg.order = order\r\n\r\n        self._action_client.wait_for_server()\r\n\r\n        self._send_goal_future = self._action_client.send_goal_async(\r\n            goal_msg,\r\n            feedback_callback=self.feedback_callback)\r\n\r\n        self._send_goal_future.add_done_callback(self.goal_response_callback)\r\n\r\n    def goal_response_callback(self, future):\r\n        goal_handle = future.result()\r\n        if not goal_handle.accepted:\r\n            self.get_logger().info('Goal rejected :(')\r\n            return\r\n\r\n        self.get_logger().info('Goal accepted :)')\r\n\r\n        self._get_result_future = goal_handle.get_result_async()\r\n        self._get_result_future.add_done_callback(self.get_result_callback)\r\n\r\n    def feedback_callback(self, feedback_msg):\r\n        feedback = feedback_msg.feedback\r\n        self.get_logger().info(f'Received feedback: {feedback.sequence}')\r\n\r\n    def get_result_callback(self, future):\r\n        result = future.result().result\r\n        self.get_logger().info(f'Result: {result.sequence}')\r\n        rclpy.shutdown()\r\n\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    action_client = FibonacciActionClient()\r\n    action_client.send_goal(10)\r\n    rclpy.spin(action_client)\r\n\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"step-4-make-scripts-executable-and-configure-setup",children:"Step 4: Make Scripts Executable and Configure Setup"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Go back to the package root:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd ~/ros2_ws/src/robot_advanced_lab\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Make the Python files executable:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"chmod +x robot_advanced_lab/math_service.py\r\nchmod +x robot_advanced_lab/math_client.py\r\nchmod +x robot_advanced_lab/fibonacci_action_server.py\r\nchmod +x robot_advanced_lab/fibonacci_action_client.py\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Edit the ",(0,i.jsx)(n.code,{children:"setup.py"})," file to add entry points for your scripts:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import os\r\nfrom glob import glob\r\nfrom setuptools import setup\r\n\r\npackage_name = 'robot_advanced_lab'\r\n\r\nsetup(\r\n    name=package_name,\r\n    version='0.0.0',\r\n    packages=[package_name],\r\n    data_files=[\r\n        ('share/ament_index/resource_index/packages',\r\n            ['resource/' + package_name]),\r\n        ('share/' + package_name, ['package.xml']),\r\n        (os.path.join('share', package_name, 'launch'), glob('launch/*.launch.py')),\r\n    ],\r\n    install_requires=['setuptools'],\r\n    zip_safe=True,\r\n    maintainer='Your Name',\r\n    maintainer_email='your.email@example.com',\r\n    description='Robot Advanced Lab for ROS 2 - Services and Actions',\r\n    license='TODO: License declaration',\r\n    tests_require=['pytest'],\r\n    entry_points={\r\n        'console_scripts': [\r\n            'math_service = robot_advanced_lab.math_service:main',\r\n            'math_client = robot_advanced_lab.math_client:main',\r\n            'fibonacci_action_server = robot_advanced_lab.fibonacci_action_server:main',\r\n            'fibonacci_action_client = robot_advanced_lab.fibonacci_action_client:main',\r\n        ],\r\n    },\r\n)\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"step-5-build-and-test-your-package",children:"Step 5: Build and Test Your Package"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Go to your workspace root directory:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd ~/ros2_ws\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Build your package:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"colcon build --packages-select robot_advanced_lab\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Source the setup file:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"source install/setup.bash\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"step-6-test-your-service-implementation",children:"Step 6: Test Your Service Implementation"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"In one terminal, run the service server:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ros2 run robot_advanced_lab math_service\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"In another terminal (remember to source setup again), run the client:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ros2 run robot_advanced_lab math_client 2 3\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"You should see the server process the request and the client receive the result."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"step-7-test-your-action-implementation",children:"Step 7: Test Your Action Implementation"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"In one terminal, run the action server:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ros2 run robot_advanced_lab fibonacci_action_server\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"In another terminal (remember to source setup again), run the client:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ros2 run robot_advanced_lab fibonacci_action_client\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Observe the feedback messages during execution and the final result."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"expected-results",children:"Expected Results"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"The math service should take two integers as input and return their sum"}),"\n",(0,i.jsx)(n.li,{children:"The Fibonacci action should generate a Fibonacci sequence of the specified order"}),"\n",(0,i.jsx)(n.li,{children:"You should receive feedback during the action execution"}),"\n",(0,i.jsx)(n.li,{children:"Both implementations should demonstrate different communication patterns in ROS 2"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"If services or actions don't connect, ensure all terminals have sourced the workspace setup"}),"\n",(0,i.jsx)(n.li,{children:"If you get import errors, verify that the example_interfaces package is installed"}),"\n",(0,i.jsx)(n.li,{children:"If the action client terminates before completion, ensure you're not accidentally ending the program too soon"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"extension-activities",children:"Extension Activities"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Modify the service to perform multiple mathematical operations (add, subtract, multiply)"}),"\n",(0,i.jsx)(n.li,{children:"Create an action that simulates a robot moving to a goal position with feedback on progress"}),"\n",(0,i.jsx)(n.li,{children:"Implement a parameter server that can dynamically adjust service behavior"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"assessment-questions",children:"Assessment Questions"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"What is the main difference between services and actions in ROS 2?"}),"\n",(0,i.jsx)(n.li,{children:"When would you use a service instead of a topic for communication?"}),"\n",(0,i.jsx)(n.li,{children:"What are the three components of an action message?"}),"\n",(0,i.jsx)(n.li,{children:"Explain the purpose of feedback in ROS 2 actions."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,i.jsx)(n.p,{children:"This lab introduced you to advanced communication patterns in ROS 2. You've implemented both services for synchronous request/response communication and actions for goal-oriented tasks with feedback. These patterns are essential for building complex robotic systems that require coordination between multiple components."})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>t,x:()=>c});var s=r(6540);const i={},a=s.createContext(i);function t(e){const n=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);